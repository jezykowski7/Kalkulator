<!DOCTYPE html>
<html lang="pl-PL">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kalkulator</title>
    <link rel="stylesheet" href="kalkulator.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
  </head>

  <body>
    <article>
      <div id="wyswietlacz">0</div>

      <div id="przyciski">
        <!-- Funkcje specjalne -->
        <div class="przycisk przycisk--spec" onclick="usun()">C</div>
        <div class="przycisk przycisk--spec">^</div>
        <div class="przycisk przycisk--spec">%</div>
        <div class="przycisk przycisk--op">/</div>

        <!-- Liczby i operatory -->
        <div class="przycisk">7</div>
        <div class="przycisk">8</div>
        <div class="przycisk">9</div>
        <div class="przycisk przycisk--op">*</div>

        <div class="przycisk">4</div>
        <div class="przycisk">5</div>
        <div class="przycisk">6</div>
        <div class="przycisk przycisk--op">-</div>

        <div class="przycisk">1</div>
        <div class="przycisk">2</div>
        <div class="przycisk">3</div>
        <div class="przycisk przycisk--op">+</div>

        <!-- Dolny rząd -->
        <div
          class="przycisk"
          style="margin-left: 10px; width: 210px; border-radius: 200px"
        >
          0
        </div>
        <div class="przycisk">.</div>
        <div class="przycisk przycisk--op" onclick="liczenie()">=</div>
      </div>
    </article>
    <script>
      let sklejonyText = "";
      let wynikPokazany = false;
      const wyswietlacz = document.getElementById("wyswietlacz");

      document.querySelectorAll(".przycisk").forEach((div) => {
        div.addEventListener("click", () => {
          const wartosc = div.textContent.trim();
          const operatory = ["+", "-", "*", "/", "^", "%"];

          if (wartosc === "C" || wartosc === "=") return;

          if (
            sklejonyText === "" &&
            operatory.includes(wartosc) &&
            wartosc !== "-"
          )
            return;

          if (
            operatory.includes(sklejonyText.slice(-1)) &&
            operatory.includes(wartosc)
          )
            return;

          if (wynikPokazany) {
            wynikPokazany = false;
          }

          if (sklejonyText.length + wartosc.length > 12) return;

          sklejonyText += wartosc;
          wyswietlacz.textContent = sklejonyText;
        });
      });

      function usun() {
        wyswietlacz.textContent = "0";
        sklejonyText = "";
      }

      function liczenie() {
        try {
          let wynik = math.evaluate(sklejonyText);

          if (wynik.toString().length > 12) wynik = formatowanieLiczby(wynik);

          wyswietlacz.textContent = wynik;
          sklejonyText = wynik.toString();
          wynikPokazany = true;
        } catch (error) {
          console.error("Błąd podczas obliczeń:", error);
          wyswietlacz.textContent = "Błąd";
          sklejonyText = "";
          wynikPokazany = false;
        }
      }
      function formatowanieLiczby(num) {
        let str = num.toString();

        for (let i = 11; i >= 0; i--) {
          let t = num.toExponential(i);
          if (t.length <= 12) return t;
        }

        return num.toExponential(0);
      }
    </script>
  </body>
</html>

